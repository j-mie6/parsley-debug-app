name: Dill-CI

# Defines when the pipeline will be invoked
on:
    push:
        branches: 
            - main
            - dev
        
    pull_request:
        branches:
            - main
            - dev

    # Allows us to run the workflow whenever we want from GitHub Actions
    workflow_dispatch:

# Defines the jobs that will be executed
concurrency:
    group: dill-ci-${{ github.ref }}
    cancel-in-progress: true

jobs:
    build:
        name: Check, test and build DILL

        # Creates a job for each OS
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-latest, macos-latest, windows-latest]

        steps:
          - uses: actions/checkout@v4
        
            # Use composite action for setup 
          - name: Setup 
            uses: ./.github/actions/setup

          - name: Test backend
            shell: bash
            run: sh scripts/test-tauri.sh

          - name: Test frontend
            shell: bash
            run: sh scripts/test-laminar.sh
          
          - name: Build app
            shell: bash
            run: sh scripts/build.sh

            # Only check app building on main 
            if: github.ref == 'refs/heads/main' 